<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Confirmados - Churrasco DIRSIS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="lista-header">
            <h1>üìã Lista de Confirmados</h1>
            <h2>Churrasco DIRSIS - 17/10 √†s 18h</h2>
            <p class="total-count">Total de pessoas: <strong>{{ total }}</strong></p>
        </div>

        {% if inscricoes %}
        <div class="lista-actions">
            <label class="select-all-container">
                <input type="checkbox" id="select-all" onchange="toggleSelectAll(this)">
                <span>Selecionar Todos</span>
            </label>
            <button id="delete-btn" class="btn-delete" onclick="deleteSelected()" disabled>
                üóëÔ∏è Deletar Selecionados (<span id="selected-count">0</span>)
            </button>
        </div>
        {% endif %}

        <div class="lista-content">
            {% if inscricoes %}
                {% for inscricao in inscricoes %}
                <div class="inscricao-card">
                    <div class="inscricao-header">
                        <label class="checkbox-container">
                            <input type="checkbox" class="inscricao-checkbox" value="{{ inscricao.email }}" onchange="updateDeleteButton()">
                        </label>
                        <span class="email">‚úâÔ∏è {{ inscricao.email }}</span>
                    </div>
                    {% if inscricao.familiares %}
                    <div class="familiares-list">
                        <strong>Acompanhantes:</strong>
                        <ul>
                            {% for familiar in inscricao.familiares %}
                            <li class="familiar-item-checkbox">
                                <label class="checkbox-container">
                                    <input type="checkbox" class="inscricao-checkbox" value="{{ familiar.id }}" onchange="updateDeleteButton()">
                                </label>
                                <span>{{ familiar.nome }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p class="no-data">Nenhuma confirma√ß√£o ainda. Seja o primeiro!</p>
            {% endif %}
        </div>

        <div class="back-link">
            <a href="/">‚¨ÖÔ∏è Voltar para Inscri√ß√£o</a>
        </div>
    </div>

    <script>
        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.inscricao-checkbox');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            updateDeleteButton();
        }

        function updateDeleteButton() {
            const checkboxes = document.querySelectorAll('.inscricao-checkbox:checked');
            const deleteBtn = document.getElementById('delete-btn');
            const countSpan = document.getElementById('selected-count');
            
            countSpan.textContent = checkboxes.length;
            deleteBtn.disabled = checkboxes.length === 0;

            const selectAll = document.getElementById('select-all');
            const totalCheckboxes = document.querySelectorAll('.inscricao-checkbox').length;
            selectAll.checked = checkboxes.length === totalCheckboxes && totalCheckboxes > 0;
        }

        async function deleteSelected() {
            const checkboxes = document.querySelectorAll('.inscricao-checkbox:checked');
            const ids = Array.from(checkboxes).map(cb => cb.value);
            
            if (ids.length === 0) return;
            
            if (!confirm(`Deseja realmente deletar ${ids.length} item(ns) selecionado(s)?`)) {
                return;
            }

            try {
                const response = await fetch('/api/inscricao/delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ids })
                });

                const result = await response.json();

                if (response.ok) {
                    alert(`‚úÖ ${result.deleted.length} item(ns) deletado(s) com sucesso!`);
                    location.reload();
                } else {
                    alert('‚ùå ' + (result.error || 'Erro ao deletar'));
                }
            } catch (error) {
                alert('‚ùå Erro ao deletar. Tente novamente.');
            }
        }
    </script>
</body>
</html>
